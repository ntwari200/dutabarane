<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{
    margin:0;
    background:#0b0b0b;
    color:white;
}
h1,h2{color:#ff2b2b;text-align:center;}

.container{
    max-width:1200px;
    margin:auto;
    padding:15px;
    display:flex;
    flex-wrap:wrap;
    gap:20px;
}

.left-section{flex:1 1 40%;display:flex;flex-direction:column;gap:20px;}
.right-section{flex:1 1 55%;display:flex;flex-direction:column;gap:20px;}

.card{
    background:#141414;
    border:2px solid #ff2b2b;
    border-radius:10px;
    padding:15px;
    box-shadow:0 0 15px rgba(255,0,0,.4);
}

input,button{
    padding:10px;
    margin:5px 0;
    width:100%;
    background:#000;
    border:2px solid #ff2b2b;
    color:white;
    border-radius:6px;
}

button{background:#ff2b2b;font-weight:bold;cursor:pointer;}
button:hover{background:#ff5555}

.table-box{overflow:auto;max-height:300px;}

table{
    width:100%;
    border-collapse:collapse;
    min-width:400px;
}
th,td{border:1px solid #ff2b2b;padding:8px;}
th{background:#ff2b2b;color:black;position:sticky;top:0;}

.search{margin-bottom:10px;}

.delete-btn{
    background:black;
    color:red;
    border:1px solid red;
    cursor:pointer;
}
.delete-btn:hover{background:red;color:black}

.amount-empty{border-color:red;}
.amount-filled{border-color:lime;}

#fileList{list-style:none;padding:0;}
#fileList li{
    padding:10px;
    margin:5px 0;
    border:1px solid #ff2b2b;
    border-radius:5px;
    cursor:pointer;
}
#fileList li:hover{background:#ff2b2b;color:black;}

@media(max-width:768px){
    .container{flex-direction:column;}
    .left-section,.right-section{flex:1 1 100%;}
}
</style>
</head>

<body>

<div class="container">
<h1 style="flex-basis:100%">ADMIN CONTROL PANEL</h1>

<!-- LEFT -->
<div class="left-section">

<div class="card">
<h2>Members</h2>
<input class="search" placeholder="Search member..." onkeyup="searchMembers(this.value)">
<form id="memberForm">
<input id="mName" placeholder="Member Name" required>
<input id="mPhone" placeholder="Phone Number" required>
<button>Add Member</button>
</form>
</div>

<div class="card">
<div class="table-box">
<table>
<thead>
<tr><th>Name</th><th>Phone</th><th>Action</th></tr>
</thead>
<tbody id="members"></tbody>
</table>
</div>
</div>

</div>

<!-- RIGHT -->
<div class="right-section">

<div class="card">
<h2>Files</h2>
<input class="search" placeholder="Search file..." onkeyup="searchFiles(this.value)">
<form id="fileForm">
<input id="fileName" placeholder="File Name" required>
<button>Create File</button>
</form>
<ul id="fileList"></ul>
</div>

<div class="card" id="fileViewer" style="display:none">
<h2 id="currentFile"></h2>
<div class="table-box">
<table>
<thead><tr><th>Member</th><th>Amount</th></tr></thead>
<tbody id="fileTable"></tbody>
</table>
</div>
<button onclick="saveFile()">Save File</button>
<button onclick="deleteFile()" class="delete-btn">Delete File</button>
</div>

</div>
</div>

<script>
const BASE="/api/";
let members=[];
let currentFileId=null;

/* MEMBERS */
async function loadMembers(){
    const r=await fetch(BASE+"members");
    members=await r.json();
    renderMembers(members);
}
function renderMembers(data){
    membersTable=document.getElementById("members");
    membersTable.innerHTML=data.map(m=>`
    <tr>
        <td>${m.name}</td>
        <td>${m.phone}</td>
        <td><button class="delete-btn" onclick="deleteMember(${m.id})">Delete</button></td>
    </tr>`).join("");
}
function searchMembers(v){
    renderMembers(members.filter(m=>m.name.toLowerCase().includes(v.toLowerCase())));
}
memberForm.onsubmit=async e=>{
    e.preventDefault();
    await fetch(BASE+"members",{method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({name:mName.value,phone:mPhone.value})});
    e.target.reset();
    loadMembers();
};

async function deleteMember(id){
    if(!confirm("Delete this member?"))return;
    await fetch(BASE+"members/"+id,{method:"DELETE"});
    loadMembers();
    if(currentFileId) openFile(currentFileId,currentFile.innerText);
}

/* FILES */
async function loadFiles(){
    const r=await fetch(BASE+"files");
    const files=await r.json();
    fileList.innerHTML=files.map(f=>`<li onclick="openFile(${f.id},'${f.name}')">${f.name}</li>`).join("");
}
function searchFiles(v){
    [...fileList.children].forEach(li=>{
        li.style.display=li.innerText.toLowerCase().includes(v.toLowerCase())?"":"none";
    });
}
fileForm.onsubmit=async e=>{
    e.preventDefault();
    await fetch(BASE+"files",{method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({name:fileName.value})});
    e.target.reset();
    loadFiles();
};

/* FILE VIEW */
async function openFile(id,name){
    currentFileId=id;
    fileViewer.style.display="block";
    currentFile.innerText=name;
    const r=await fetch(BASE+"files/"+id);
    const data=await r.json();
    fileTable.innerHTML=members.map(m=>`
    <tr>
        <td>${m.name}</td>
        <td><input value="${data[m.id]||''}" 
            oninput="colorAmount(this)" 
            class="${data[m.id]?'amount-filled':'amount-empty'}"></td>
    </tr>`).join("");
}
function colorAmount(i){
    i.className=i.value.trim()? "amount-filled":"amount-empty";
}
async function saveFile(){
    const payload={};
    [...fileTable.querySelectorAll("tr")].forEach((tr,i)=>{
        payload[members[i].id]=tr.querySelector("input").value;
    });
    await fetch(BASE+"files/"+currentFileId,{method:"PUT",
    headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    alert("File saved");
}
async function deleteFile(){
    if(!confirm("Delete file?"))return;
    await fetch(BASE+"files/"+currentFileId,{method:"DELETE"});
    fileViewer.style.display="none";
    loadFiles();
}

loadMembers();
loadFiles();
</script>

</body>
</html>
